<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Ian(忆南) He(何)">


    <meta name="subtitle" content="静静地旁观，默默地思考，然后开心的笑笑，就好了">


    <meta name="description" content="Ian He">



<title>Work in Trustnote(3) | Ian He&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">IanHe&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">IanHe&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Work in Trustnote(3)</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Ian(忆南) He(何)</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">十二月 11, 2018&nbsp;&nbsp;17:35:42</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="Catchup"><a href="#Catchup" class="headerlink" title="Catchup"></a>Catchup</h2><p>In Bitcoin, there is two kind of catchup:</p>
<ul>
<li>Small catchup</li>
<li>Large catchup</li>
</ul>
<h4 id="Small-catchup"><a href="#Small-catchup" class="headerlink" title="Small catchup"></a>Small catchup</h4><ul>
<li>Downloader sends getblocks(locator(dChainHead), 0)</li>
<li>Responder sends invs for blocks from dChainHead to rChainHead</li>
<li>Downloader sends getdata for each inv</li>
<li>Responder sends blocks for each getdata</li>
</ul>
<h4 id="Large-catchup"><a href="#Large-catchup" class="headerlink" title="Large catchup"></a>Large catchup</h4><ul>
<li>Downloader sends getblocks(locator(dChainHead), 0)</li>
<li>Responder sends invs for blocks from dChainHead to dChainHead + 500</li>
<li>(getdata / blocks sent by responder / blocks added to chain by downloader)</li>
<li>The last getdata triggers an inv(rChainHead)</li>
<li>Downloader sends getdata(rChainHead)</li>
<li>Responder sends block</li>
<li>Downloader puts block on orphan list</li>
<li>Downloader sends getblocks(locator(dChainHead), rChainHead)</li>
<li>goto step 2</li>
</ul>
<p>The first thing bitcoin get is a chain that build by headers. And the most interesting thing about it is that we don’t need to care about the transations inside the block. We only need to verify that this block is valid. But why?</p>
<p>The header of bitcoin is :</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Purpose</th>
<th>Updated when…</th>
<th>Size (Bytes)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Version</td>
<td>Block version number</td>
<td>You upgrade the software and it specifies a new version</td>
<td>4</td>
</tr>
<tr>
<td>hashPrevBlock</td>
<td>256-bit hash of the previous block header</td>
<td>A new block comes in</td>
<td>32</td>
</tr>
<tr>
<td>hashMerkleRoot</td>
<td>256-bit hash based on all of the transactions in the block</td>
<td>A transaction is accepted</td>
<td>32</td>
</tr>
<tr>
<td>Time</td>
<td>Current timestamp as seconds since 1970-01-01T00:00 UTC</td>
<td>Every few seconds</td>
<td>4</td>
</tr>
<tr>
<td>Bits</td>
<td>Current target in compact format</td>
<td>The difficulty is adjusted</td>
<td>4</td>
</tr>
<tr>
<td>Nonce</td>
<td>32-bit number (starts at 0)</td>
<td>A hash is tried (increments)</td>
<td>4</td>
</tr>
</tbody>
</table>
<p>So the header has everything we need to verify the block. And the we don’t need to worry about double check or bad transation, which will be verified by following blocks. And this is where magic is. A light client can also store a bitcoin’s chain in this way, and it only need to get its transations but still can verify them because of the merkle root. And a full client can get those details from different responser by different sequence and skip the validation of UTXO.</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Ian(忆南) He(何)</span>
                    </p>
                
                
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/Bitcoin/"># Bitcoin</a>
                    
                        <a href="/tag/Blockchain/"># Blockchain</a>
                    
                        <a href="/tag/Trustnote/"># Trustnote</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2018/12/12/Work-in-Trustnote-4/">Work in Trustnote(4)</a>
            
            
            <a class="next" rel="next" href="/2018/12/11/Work-in-Trustnote-2/">Work in Trustnote(2)</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Ian(忆南) He(何) | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
