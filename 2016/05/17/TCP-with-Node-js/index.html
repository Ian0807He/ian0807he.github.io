<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>TCP with Node.js | Ian He&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="/avator.png">
  <link rel="stylesheet" href="/css/app.css">
  <!-- <link rel='stylesheet' href='http://fonts.useso.com/css?family=Source+Code+Pro'> -->
</head>

<body>
  <nav class="app-nav">
  
    
        <a href="/."><button>home</button></a>
      
    
    
        <a href="/archives"><button>archive</button></a>
      
    
    
        <a href="/tags"><button>tags</button></a>
      
    
    
        <a href="/about"><button>about</button></a>
      
    
</nav>
<script src="/js/button.js"></script>

  <main class="post">
  <article>
  <h1 class="article-title">
    <a href="/2016/05/17/TCP-with-Node-js/">TCP with Node.js</a>
  </h1>

  <section class="article-meta">
    <p class="article-date">五月 17 2016</p>
  </section>

  <section class="article-entry">
    <h1 id="Chat-Server"><a href="#Chat-Server" class="headerlink" title="Chat Server"></a>Chat Server</h1><h2 id="Server内容"><a href="#Server内容" class="headerlink" title="Server内容"></a>Server内容</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var net = require(<span class="string">'net'</span>);</span><br><span class="line"></span><br><span class="line">var server = net.createServer();</span><br><span class="line"></span><br><span class="line">var sockets = [];</span><br><span class="line"></span><br><span class="line">//接受连接</span><br><span class="line">server.on(<span class="string">'connection'</span>, <span class="keyword">function</span>(socket)&#123;</span><br><span class="line">  console.log(<span class="string">'got a new connection'</span>);</span><br><span class="line">  </span><br><span class="line">  //聚合所有客户端信息</span><br><span class="line">  sockets.push(socket);</span><br><span class="line">  </span><br><span class="line">  //监听所有客户端信息，并进行广播</span><br><span class="line">  socket.on(<span class="string">'data'</span>, <span class="keyword">function</span>(data)&#123;</span><br><span class="line">    console.log(<span class="string">'got data:'</span>,data);</span><br><span class="line">    sockets.forEach(<span class="keyword">function</span>(otherSocket)&#123;</span><br><span class="line">      <span class="keyword">if</span>(otherSocket != socket)&#123;</span><br><span class="line">        otherSocket.write(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  socket.on(<span class="string">'close'</span>, <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    console.log(<span class="string">'connection closed'</span>);</span><br><span class="line">    var index = sockets.indexOf(socket);</span><br><span class="line">    sockets.splice(index, 1);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'error'</span>, <span class="keyword">function</span>(err) &#123;</span><br><span class="line">  console.log(<span class="string">'Server error:'</span>, err.message);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'close'</span>, <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">  console.log(<span class="string">'Server closed'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(4001);</span><br></pre></td></tr></table></figure>
<h2 id="Client命令"><a href="#Client命令" class="headerlink" title="Client命令"></a>Client命令</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nc localhost XXXX(你选择的端口号)</span><br></pre></td></tr></table></figure>
<p>然后输入你想发送的信息，你就可以在其他客户端看到你的消息了</p>

  </section>
</article>

</main>

</body>
</html>
